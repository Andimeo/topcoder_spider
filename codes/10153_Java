<td class="problemText" colspan="8" valign="middle" align="left">
            public class GroupedWord {<br><br>  public String restore(String w[]) {<br><br>    // invalid ?<br>    for(String s : w) {<br>      if( invalid(s) ) { return "IMPOSSIBLE"; }<br>    }<br><br>    int len = w.length;<br><br>    // all same<br>    for(int i=0; i&lt;len; ++i) {<br>      if( same(w[i]) ) {<br>        char con = w[i].charAt(0);<br>        for(int j=0; j&lt;len; ++j) {<br>          if( i == j ) { continue; }<br>          boolean tail = false;<br>          if( w[j].charAt(0) == con || (tail = (w[j].charAt(w[j].length() - 1) == con)) ) {<br>            String next[] = new String[len-1];<br>            int p = 0;<br>            int q = 0;<br>            for(int k=0; k&lt;len; ++k) {<br>              if( i == k ) { continue; }<br>              if( j == k ) { q = p; }<br>              next[p++] = w[k];<br>            }<br>            next[q] = tail ? w[j] + w[i] : w[i] + w[j];<br>            return restore(next);<br>          }<br>        }<br>      }<br>    }<br><br>    // head : tail<br>    for(int i=0; i&lt;len; ++i) {<br>      for(int j=0; j&lt;len; ++j) {<br>        if( i == j ) { continue; }<br>        if( w[i].charAt(0) == w[j].charAt(w[j].length() - 1) ) {<br>          String next[] = new String[len-1];<br>          int p = 0;<br>          int q = 0;<br>          for(int k=0; k&lt;len; ++k) {<br>            if( i == k ) { continue; }<br>            if( j == k ) { q = p; }<br>            next[p++] = w[k];<br>          }<br>          next[q] = w[j] + w[i];<br>          return restore(next);<br>        }<br>      }<br>    }<br><br>    // fail case<br>    for(int i=0; i&lt;len; ++i) {<br>      for(int j=0; j&lt;len; ++j) {<br>        if( i == j ) { continue; }<br>        for(char c='a'; c&lt;='z'; ++c) {<br>          if( w[i].indexOf(c) &gt;= 0 &amp;&amp; w[j].indexOf(c) &gt;= 0 ) { return "IMPOSSIBLE"; }<br>        }<br>      }<br>    }<br><br>    if( w.length == 1 ) { return w[0]; }<br>    return "MANY";<br><br>  }<br><br>  boolean same(String s) {<br>    char c = s.charAt(0);<br>    for(int i=1; i&lt;s.length(); ++i) {<br>      if( s.charAt(i) != c ) { return false; }<br>    }<br>    return true;<br>  }<br><br>  boolean invalid(String s) {<br>    for(char c='a'; c&lt;='z'; ++c) {<br>      int st = s.indexOf(c);<br>      int ed = s.lastIndexOf(c);<br>      if( st == ed ) { continue; }<br>      while( st &lt; ed &amp;&amp; s.charAt(st + 1) == c ) { ++st; }<br>      if( st != ed ) { return true; }<br>    }<br>    return false;<br>  }<br><br>}<br></td>