<td class="problemText" colspan="8" valign="middle" align="left">
            using System;<br><br>public class PerfectRectangles {<br>  public int numberOfRectangles(int N, int M, int X0, int A, int B, int Y0, int C, int D) {<br>        bool[,] f = new bool[N, N];<br>        int x = X0 % N;<br>        int y = Y0 % N;<br>        for (int i = 0; i &lt; M; ++i) {<br>            f[x, y] = true;<br>            x = (x * A + B) % N;<br>            y = (y * C + D) % N;<br>        }<br>        return num(N, f);<br>  }<br><br>    private int num(int N, bool[,] f)<br>    {<br>        int[,] cnt = new int[N, N];<br>        int res = 0;<br>        for (int r = 0; r &lt; N; ++r)<br>        {<br>            for (int c = 0; c &lt; N; ++c)<br>            {<br>                if (!f[r, c])<br>                {<br>                    cnt[r, c] = 1;<br>                    if (r &gt; 0)<br>                        cnt[r, c] += cnt[r - 1, c];<br>                }<br>            }<br>        }<br>        for (int r = 0; r &lt; N; ++r)<br>        {<br>            int[] stk = new int[N];<br>            int sp = 0;<br>            int lsp = 0;<br>            for (int c = 0; c &lt; N; ++c)<br>            {<br>                if (!f[r, c])<br>                {<br>                    while (sp &gt; 0 &amp;&amp; stk[sp - 1] &gt;= cnt[r, c])<br>                    {<br>                        --sp;<br>                    }<br>                    stk[sp++] = cnt[r, c];<br>                    if (lsp &gt; sp)<br>                        lsp = sp;<br>                }<br>                else<br>                {<br>                    sp = 0;<br>                    lsp = 0;<br>                }<br>                if (r == N - 1 || f[r + 1, c])<br>                    lsp = sp;<br>                {<br>                    int nxt = c == N - 1 ? 0 : cnt[r, c + 1];<br>                    int le = -1;<br>                    int ri = lsp;<br>                    while (ri - le &gt; 1)<br>                    {<br>                        int m = (le + ri) / 2;<br>                        if (stk[m] &gt; nxt)<br>                            ri = m;<br>                        else<br>                            le = m;<br>                    }<br>                    res += (lsp - ri);<br>                }<br>            }<br>        }<br>        return res;<br>    }<br>}<br><br><br>// Powered by FileEdit<br>// Powered by TZTester 1.01 [25-Feb-2003] [modified for C# by Petr]<br>// Powered by CodeProcessor<br></td>