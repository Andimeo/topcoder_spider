<td class="problemText" colspan="8" valign="middle" align="left">
            import java.util.*;<br> <br>public class TwoSidedCards {<br>    private static final long MOD = 1000000007;<br> <br>    long[][] C;<br> <br>    public int theCount(int[] taro, int[] hanako) {<br>        long res = 1;<br>        int n = taro.length;<br>        C = new long[n + 1][n + 1];<br>        for (int i = 0; i &lt;= n; i++) {<br>            C[i][0] = 1;<br>            C[i][i] = 1;<br>            for (int j = 1; j &lt; i; j++) {<br>                C[i][j] = C[i - 1][j - 1] + C[i - 1][j];<br>                C[i][j] %= MOD;<br>            }<br>        }<br>                <br>        int[] q = new int[n];<br>        for (int i = 0; i &lt; n; i++) {<br>            q[taro[i] - 1] = hanako[i] - 1;<br>        }<br>        boolean[] z = new boolean[n];<br>        int nn = n;<br>        for (int i = 0; i &lt; n; i++) {<br>            if (!z[i]) {<br>                int j = i;<br>                int c = 0;<br>                while (!z[j]) {<br>                    c++;<br>                    z[j] = true;<br>                    j = q[j];<br>                }<br>                res *= C[nn][c];<br>                res %= MOD;<br>                res *= calc(c);<br>                res %= MOD;<br>                nn -= c;<br>                //System.out.println(c);<br>            }<br>        }<br>        return (int) res;<br>    }<br> <br>    private long calc(int n) {<br>        long res = 0;<br>        for (int i = 0; i &lt;= n / 2; i++) {<br>            long z = C[n][2  * i];<br>            if (i &gt; 0) {<br>                z *= 2;<br>                z %= MOD;<br>            }<br>            int nn = n;<br>            for (int j = 0; j &lt; i; j++) {<br>                z *= C[nn][2];<br>                z %= MOD;<br>                nn -= 2;<br>            }<br>            while (nn &gt; 1) {<br>                z *= nn;<br>                z %= MOD;<br>                nn--;<br>            }<br>            res += z;<br>            res %= MOD;<br>        }<br>        //System.out.println(n + " "  + res);<br>        return res;<br>    }<br> <br>}<br> <br> <br>// Powered by FileEdit<br>// Powered by RETester [based on ExampleBuilder]<br>// Powered by CodeProcessor<br></td>