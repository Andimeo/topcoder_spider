<td class="problemText" colspan="8" valign="middle" align="left">
            using System; using System.Collections; using System.Text; public class Jewelry {<br>public long howMany(int[] values) {<br>Array.Sort(values);<br>int N = values.Length;<br> <br>int[] fk = new int[N];<br>int[] gk = new int[N];<br>int[] mc = new int[N];<br>for (int i=0; i&lt;N; i++)<br> if (i&gt;0 &amp;&amp; values[i] == values[i-1])<br>  fk[i] = fk[i-1]+1;<br> else<br>  fk[i] = 1;<br> <br>for (int i=N-1; i&gt;=0; i--)<br> if (i &lt; N-1 &amp;&amp; values[i] == values[i+1])<br>  gk[i] = gk[i+1]+1;<br> else<br>  gk[i] = 1;<br> <br>for (int i=0; i&lt;N; i++)<br> for (int j=0; j&lt;N; j++)<br>  if (values[i] == values[j])<br>   mc[i]++;<br> <br> <br>long[,] ch = new long[31,62];<br>for (int j=0; j&lt;=60; j++)<br> {<br> ch[0,j] = 1;<br> for (int i=1; i&lt;=j &amp;&amp; i &lt;= 30; i++)<br>  {<br>  if (i &lt; j)<br>   ch[i,j] = ch[i,j-1];<br>  if (i &gt; 0)<br>   ch[i,j] += ch[i-1,j-1];<br>  }<br> }<br> <br>long[,] F = new long[30001,30];<br>for (int v=1; v&lt;=30000; v++)<br> for (int i=0; i&lt;N; i++)<br>  {<br>  int v2 = v - values[i] * fk[i];<br>  if (v2 == 0)<br>   F[v,i] = 1;<br>  else if (v2 &gt; 0)<br>   for (int j=0; j&lt;=i-fk[i]; j++)<br>    F[v,i] += F[v2,j] * ch[fk[j],mc[j]];<br>  }<br> <br>long[,] G = new long[30001,30];<br>for (int v=1; v&lt;=30000; v++)<br> for (int i=N-1; i&gt;=1; i--)<br>  {<br>  int v2 = v - values[i] * gk[i];<br>  if (v2 == 0)<br>   G[v,i] = 1;<br>  else if (v2 &gt; 0)<br>   for (int j=i+gk[i]; j&lt;N; j++)<br>    G[v,i] += G[v2,j] * ch[gk[j],mc[j]];<br>  }<br> <br>//WS(F,20,6);<br> <br>long tot = 0;<br>for (int i=1; i&lt;=30000; i++)<br> for (int j=0; j&lt;=N-2; j++)<br>  for (int k=j+1; k&lt;N; k++)<br>   {<br>   int a = fk[j];<br>   int b = gk[k];<br>   long t2 = F[i,j] * G[i,k];<br>   if (t2 == 0) continue;<br>   if (values[j] == values[k])<br>    {<br>    //int c = k-j-1 + a + b;<br>    int c = mc[j];<br>    t2 *= ch[a,c] * ch[b,c-a];<br>    //WS(i,values[j],values[k],t2); WL();<br>    }<br>   else<br>    {<br>    int c = mc[j];<br>    int d = mc[k];<br>    //WS(i,j,k,t2,a,b,c,d); WL();<br>    //WS(ch[a,c], ch[b,d]); WL();<br>    <br>    //WS(a,c,ch[a,c],"",b,d,ch[b,d]); WL();<br>    t2 *= ch[a,c] * ch[b,d];<br>    }<br>   //if (t2 &gt; 0) { WS(i,j,k,t2); WL(); }<br>   tot += t2;<br>   }<br> <br>return tot;<br>}<br> <br> <br> <br> <br>static void WR(String s) { Console.Write(s); }<br>static void WR(Object x, params object[] p) { Console.Write(x.ToString(), p); }<br>static void WL(Object x, params object[] p) { Console.WriteLine(x.ToString(), p); }<br>static void WL() { WL(""); }<br>static void WS(params Object[] c) { foreach (Object x in c) WR(x.ToString() + " "); }<br>static void WS(int[] ar, int X) { for (int x=0; x&lt;X; x++) WS(ar[x]); WL(); }<br>static void WS(int[,] ar, int X, int Y) { for (int y=0; y&lt;Y; y++) { for (int x=0; x&lt;X; x++) WS(ar[x,y]); WL(); }}<br>void MATCH(String lbl, Object x, Object y)<br> { if (!x.Equals(y)) throw new Exception(lbl + String.Format(" expected [{0}], got [{1}]", x, y)); }<br>void MATCH(ICollection x, ICollection y) {<br> MATCH("count", x.Count, y.Count);<br> int i=0; ArrayList ay = new ArrayList(y);<br> foreach (Object ox in x) { MATCH(i.ToString(), ox, ay[i]); i++; }<br>}}<br></td>