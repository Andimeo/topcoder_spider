<td class="problemText" colspan="8" valign="middle" align="left">
            import java.util.*;<br>public class FoxAndTouristFamilies{<br>  public double expectedLength(int[] A, int[] B, int[] f) {<br>    int n=A.length+1;<br>    int m=f.length;<br>    double[][] probs=new double[m][n-1];<br>    int[][] pres=new int[n][n];<br>    for (int i=0;i&lt;n;++i)for (int j=0;j&lt;n;++j)pres[i][j]=-1;<br>    for (int i=0;i&lt;n-1;++i){<br>      int a=A[i], b=B[i];<br>      pres[a][b]=pres[b][a]=i;<br>    }<br>    for (int k=0;k&lt;n;++k)for (int i=0;i&lt;n;++i)for(int j=0;j&lt;n;++j) {<br>      if (pres[i][j]==-1 &amp;&amp; pres[i][k] !=-1 &amp;&amp; pres[k][j] !=-1)pres[i][j]=pres[i][k];<br>    }<br>    double unit=1.0/(n-1);<br>    for (int ii=0;ii&lt;m;++ii)for (int j=0;j&lt;n;++j) {<br>      int i=f[ii];<br>      if (i==j)continue;<br>      int from=i, to=j;<br>      while(from!=to) {<br>        int k=pres[from][to]; //road<br>        probs[ii][k]+=unit;<br>        int a=A[k], b=B[k];<br>        if (a==from)from=b;<br>        else from=a;<br>      }<br>    }<br>    <br>    double res=0;<br>    for (int j=0;j&lt;n-1;++j){<br>      double t=1;<br>      for (int i=0;i&lt;m;++i){ //System.out.println(Arrays.toString(probs[i]));<br>        t*=probs[i][j];<br>      }<br>      res+=t;<br>    }<br>    return res;<br>  }<br>}<br></td>