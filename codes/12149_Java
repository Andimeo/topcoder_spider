<td class="problemText" colspan="8" valign="middle" align="left">
            import java.util.*;<br>import java.math.*;<br><br>public class YetAnotherNim {<br>  static final long MOD = (long)(1e9 + 7);<br><br>  long power(long base, long exponent) {<br>    if (exponent == 0)<br>      return 1;<br>    if ((exponent &amp; 1) == 1)<br>      return base * power(base, exponent - 1) % MOD;<br>    long result = power(base, exponent &gt;&gt; 1);<br>    return result * result % MOD;<br>  }<br><br>  public int solve(int n, int m, int k) {<br>    int bitLength = Integer.bitCount(m);<br>    if (k &gt; bitLength)<br>      return (int)power(m, n);<br>    long[][] mat = new long[k][k];<br>    for (int i = 0; i &lt; k - 1; i++) {<br>      for (int j = 0; j &lt;= i; j++)<br>        mat[i][j] = 1 &lt;&lt; j;<br>      mat[i][i + 1] = m - (1 &lt;&lt; (i + 1)) + 1;<br>    }<br>    mat[k - 1][k - 1] = m;<br>    long[][] temp = new long[k][k];<br>    long[][] result = new long[k][k];<br>    power(result, temp, mat, n - 1);<br>    long answer = power(m, n) - result[0][k - 1] * m % MOD;<br>    if (answer &lt; 0)<br>      answer += MOD;<br>    return (int)answer;<br>  }<br>  <br>  void power(long[][] result, long[][] temp, long[][] mat, long exponent) {<br>    if (exponent == 0) {<br>      for (int i = 0; i &lt; result.length; i++)<br>        result[i][i] = 1;<br>      return;<br>    }<br>    if ((exponent &amp; 1) == 1) {<br>      power(temp, result, mat, exponent - 1);<br>      multiply(result, temp, mat);<br>    } else {<br>      power(temp, result, mat, exponent &gt;&gt; 1);<br>      multiply(result, temp, temp);<br>    }<br>  }<br>  <br>  void multiply(long[][] a, long[][] b, long[][] c) {<br>    for (int i = 0; i &lt; a.length; i++) {<br>      for (int j = 0; j &lt; a.length; j++) {<br>        a[i][j] = 0;<br>        for (int k = 0; k &lt; a.length; k++)<br>          a[i][j] += b[i][k] * c[k][j] % MOD;<br>        a[i][j] %= MOD;<br>      }<br>    }<br>  }<br>}<br><br><br>// Powered by FileEdit<br></td>