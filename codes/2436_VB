<td class="problemText" colspan="8" valign="middle" align="left">
            Imports Microsoft.VisualBasic<br>Imports System.Math<br>Imports System<br>Imports System.Collections<br>Imports System.Text<br> <br>Public Class ChipRace<br>    Private cache(100000) As Double<br> <br>    Public Function chances(ByVal chips As Integer()) As Double()<br>        Dim chipCount(4) As Integer<br>        Dim a As Integer<br>        For a = 0 To chips.Length - 1<br>            chipCount(chips(a)) += 1<br>        Next<br>        Dim sum As Integer = 0<br>        For a = 1 To 4<br>            sum += a * chipCount(a)<br>        Next<br>        Dim ret(chips.Length - 1) As Double<br>        For a = 0 To chips.Length - 1<br>            chipCount(chips(a)) -= 1<br>            ret(a) = doit(chips(a), chipCount, Round(sum / 5))<br>            chipCount(chips(a)) += 1<br>        Next<br>        Return ret<br>    End Function<br> <br>    Private Function doit(ByVal mychip As Integer, ByVal chipCount() As Integer, ByVal togive As Integer) As Double<br>        Dim hash As Integer = mychip<br>        Dim a As Integer<br>        For a = 1 To 4<br>            hash = hash * 11 + chipCount(a)<br>        Next<br>        If cache(hash) &gt; 0 Then Return cache(hash)<br>        Dim ret As Double<br> <br>        If mychip = 0 OrElse togive = 0 Then<br>            ret = 0<br>        Else<br>            Dim sum As Integer = mychip<br>            For a = 1 To 4<br>                sum += a * chipCount(a)<br>            Next<br>            ret = mychip / sum<br>            For a = 1 To 4<br>                If chipCount(a) &gt; 0 Then<br>                    Dim prob As Double = a / sum<br>                    chipCount(a) -= 1<br>                    ret += (chipCount(a) + 1) * prob * doit(mychip, chipCount, togive - 1)<br>                    chipCount(a) += 1<br>                End If<br>            Next<br>        End If<br> <br>        cache(hash) = ret<br>        Return ret<br>    End Function<br>End Class<br></td>