<td class="problemText" colspan="8" valign="middle" align="left">
            using System;<br>using System.Collections;<br> <br>public class RingCount<br>{<br>  string[] b;<br>  int lx,ly;<br>  int [,] m;<br>  bool [,] used;<br>  int cnt = 0;<br>  <br>  void explore(int i, int j, int n)<br>  {  <br>    <br>    if (used[i,j]) return;<br>    used[i,j] = true;<br>    m[i,j] = n;<br>    cnt++;<br>    if (i &gt; 0 &amp;&amp; b[j][i] == b[j][i-1]) explore(i-1, j, n); <br>    if (i &lt; lx-1 &amp;&amp; b[j][i] == b[j][i+1]) explore(i+1, j, n);     <br>    if (j &gt; 0 &amp;&amp; b[j][i] == b[j-1][i]) explore(i, j-1, n);     <br>    if (j &lt; ly-1 &amp;&amp; b[j][i] == b[j+1][i]) explore(i, j+1, n);         <br>  }<br>  <br>  bool adj(int i, int j, int n)<br>  {<br>    for(int x = i-1; x&lt;=i+1; x++)<br>    for(int y = j-1; y&lt;=j+1; y++)<br>    if (x != i &amp;&amp; y != j)<br>    {<br>      if (x &lt; 0 || y &lt; 0 || x &gt; lx-1 || y &gt; ly-1) continue;<br>      if (m[x,y] == n) return true;          <br>    }<br>    return false;<br>  }<br>  <br>  <br>  void show2()<br>  {<br>    for(int i = 0; i&lt;ly; i++)<br>    {<br>      for(int j = 0; j&lt;lx; j++)<br>      {<br>        Console.Write(m[j,i]);<br>      }<br>      Console.WriteLine();<br>    }<br>  }  <br> <br>  void showused()<br>  {<br>    for(int i = 0; i&lt;ly; i++)<br>    {<br>      for(int j = 0; j&lt;lx; j++)<br>      {<br>        if (used[j,i]) Console.Write("1"); else Console.Write("0");<br>      }<br>      Console.WriteLine();<br>    }<br>  }  <br>  public int count(string[] bitmap)<br>  {<br>    this.b = bitmap;<br>    lx = b[0].Length;<br>    ly = b.Length;<br>    <br>    m = new int[lx,ly];<br>    used = new bool[lx,ly];<br>    <br>    int n = 1;<br>    <br>    for(int i = 0; i&lt;ly; i++)<br>    {<br>      m[0,i] = m[lx-1,i] = 1;      <br>      if (b[i][0] != '.' || b[i][lx-1] != '.') return -1;<br> <br>    }<br>    <br>    for(int i = 0; i&lt;lx; i++)<br>    {<br>      m[i,0] = m[i, ly-1] = 1;      <br>      if (b[0][i] != '.' || b[ly-1][i] != '.') return -1;      <br> <br>    }<br>    <br>    <br>    while(cnt &lt; lx * ly)<br>    {<br>      int z = 0;<br>      <br>      for(int i = 0; i&lt;lx; i++)<br>      for(int j = 0; j&lt;ly; j++)<br>      {<br>        if (m[i,j] == n &amp;&amp; !used[i,j])<br>        {<br>          explore(i,j,n);<br>          z++;<br>        }<br>      }<br>      <br> <br> <br>      if (z != 1) return -1;<br> <br>      for(int i = 0; i&lt;lx; i++)<br>      for(int j = 0; j&lt;ly; j++)<br>      {<br>        if (adj(i,j, n))<br>        {<br>          if (m[i,j] == 0)<br>          {<br>            <br>            if (b[j][i] == '.') <br>            {<br>              Console.WriteLine("{0} {1} {2}", i, j, n);            <br>              return -1;<br>            }<br>            m[i,j] = n+1;<br>          }<br>        }<br>      }<br>      n++;<br>      z = 0;<br>      for(int i = 0; i&lt;lx; i++)<br>      for(int j = 0; j&lt;ly; j++)<br>      {<br>        if (m[i,j] == n &amp;&amp; !used[i,j])<br>        {<br>          explore(i,j,n);<br>          z++;<br>        }<br>      }<br>      Console.WriteLine(z);<br>      if (z != 1) return -1;<br>      for(int i = 0; i&lt;lx; i++)<br>      for(int j = 0; j&lt;ly; j++)<br>      {<br>        if (adj(i,j, n))<br>        {<br>          if (m[i,j] == 0)<br>          {<br>            if (b[j][i] != '.') return -1;<br>            m[i,j] = n+1;<br>          }<br>        }<br>      }<br>      show2();<br>      Console.WriteLine("{0} {1}", lx*ly, cnt);<br>      n++;<br> <br>    }<br>    <br>    return n/2;<br>    <br>  }<br>}<br></td>