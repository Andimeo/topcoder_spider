<td class="problemText" colspan="8" valign="middle" align="left">
            #include &lt;map&gt;<br>#include &lt;set&gt;<br>#include &lt;cmath&gt;<br>#include &lt;queue&gt;<br>#include &lt;vector&gt;<br>#include &lt;string&gt;<br>#include &lt;cstdio&gt;<br>#include &lt;cstdlib&gt;<br>#include &lt;cstring&gt;<br>#include &lt;cassert&gt;<br>#include &lt;numeric&gt;<br>#include &lt;algorithm&gt;<br> <br>using namespace std;<br> <br>typedef vector&lt;int&gt; vi;<br>typedef vector&lt;vi&gt; vvi;<br>typedef vector&lt;string&gt; vs;<br> <br>#define Mp(x,y) make_pair(x,y)<br>#define For(i,a,b) for(int i=(a); i&lt;=(b); i++)<br>#define Rep(i,n) for(int i=0; i&lt;(n); i++)<br>#define Size(x) (int(x.size()))<br> <br>const int mod=10000;<br> <br>vvi matmult(vvi a,vvi b)<br>{<br>  int n=Size(a);<br>  vvi res(n,vi(n,0));<br>  Rep(i,n) Rep(j,n) Rep(k,n) <br>    res[i][j]=(res[i][j]+a[i][k]*b[k][j])%mod;<br>  return res;<br>}<br> <br>vvi matpow(vvi a,int n)<br>{  <br>  vvi b(Size(a),vi(Size(a),0));<br>  Rep(i,Size(b)) b[i][i]=1;<br>  while(n&gt;0)<br>  {<br>    if(n&amp;1) b=matmult(b,a);<br>    n&gt;&gt;=1;<br>    a=matmult(a,a);<br>  }<br>  return b;<br>}<br> <br>vs dict;<br>int n,m;<br> <br>string suf(string st,int len)<br>{<br>  return st.substr(Size(st)-len,len);<br>}<br> <br>void foo(string st,int &amp;i,int &amp;j)<br>{<br>  Rep(k,Size(dict)) if(Size(st)&gt;=Size(dict[k]) &amp;&amp; suf(st,Size(dict[k]))==dict[k])<br>  {<br>    i=k;<br>    j=Size(dict[k]);<br>    return;<br>  }<br>  i=j=0;<br>  Rep(k,Size(dict)) <br>  {<br>    int t=min(Size(st),Size(dict[k]));<br>    while(t&gt;j &amp;&amp; suf(st,t)!=dict[k].substr(0,t)) --t;<br>    if(t&gt;j)<br>    {<br>      i=k;<br>      j=t;<br>    }<br>  }<br>}<br> <br>int bar(int x,int n)<br>{<br>  int res=1;<br>  while(n&gt;0)<br>  {<br>    if(n&amp;1) res=(res*x)%mod;<br>    n&gt;&gt;=1;<br>    x=(x*x)%mod;<br>  }<br>  return res;<br>}<br> <br>struct SuspiciousStrings<br>{<br>  int getAmount(vs dict,int n)<br>  {<br>    ::dict=dict;<br>    ::n=n;<br>    vector&lt;pair&lt;int,int&gt; &gt; ss;<br>    ss.push_back(Mp(0,0));<br>    Rep(i,Size(dict)) For(j,1,Size(dict[i])-1)<br>      ss.push_back(Mp(i,j));<br>    int m=Size(ss);<br>    vvi a(m,vi(m));<br>    Rep(i,m) for(char ch='a'; ch&lt;='z'; ++ch)<br>    {<br>      int x,y;<br>      foo(dict[ss[i].first].substr(0,ss[i].second)+ch,x,y);<br>      if(y&lt;Size(dict[x]))<br>      {<br>        int t=0;<br>        while(ss[t]!=Mp(x,y)) ++t;<br>        ++a[t][i];<br>      }<br>    }<br>    a=matpow(a,n);<br>    int res=0;<br>    Rep(i,m) res+=a[i][0];<br>    res%=mod;<br>    res=bar(26,n)-res;<br>    res%=mod;<br>    if(res&lt;0) res+=mod;<br>    return res;<br>  }<br>};<br></td>