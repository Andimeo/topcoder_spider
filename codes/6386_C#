<td class="problemText" colspan="8" valign="middle" align="left">
            using System;<br><br>public class TourCounting {<br>  public int countTours(string[] g, int k, int m) {<br>    int n = g.Length;<br>    long[,] a = new long[n, n];<br>    for (int i = 0; i &lt; n; ++i)<br>      for (int j = 0; j &lt; n; ++j)<br>        if (g[i][j] == 'Y')<br>          a[i, j] = 1;<br>    long[,] z = lsum(a, k - 1, m, n);<br>    long res = 0;<br>    for (int i = 0; i &lt; n; ++i)<br>      res = (res + z[i, i]) % m;<br>    return (int) res;<br>  }<br><br>  long[,] lsum(long[,] a, int k, int m, int n)<br>  {<br>    if (k == 0)<br>      return zero(n);<br>    else if (k % 2 != 0)<br>      return add(mul(a, lsum(a, k - 1, m, n), m, n), a, m, n);<br>    else<br>    {<br>      long[,] p = lsum(a, k / 2, m, n);<br>      return add(p, mul(p, pow(a, k / 2, m, n), m, n), m, n);<br>    }<br>  }<br><br>  long[,] pow(long[,] a, int k, int m, int n)<br>  {<br>    if (k == 0)<br>      return one(n);<br>    else if (k % 2 != 0)<br>      return mul(a, pow(a, k - 1, m, n), m, n);<br>    else<br>      return pow(mul(a, a, m, n), k / 2, m, n);<br>  }<br><br>  long[,] one(int n)<br>  {<br>    long[,] a = new long[n, n];<br>    for (int i = 0; i &lt; n; ++i)<br>      a[i, i] = 1;<br>    return a;<br>  }<br><br>  long[,] add(long[,] a, long[,] b, int m, int n)<br>  {<br>    long[,] c = new long[n, n];<br>    for (int i = 0; i &lt; n; ++i)<br>      for (int j = 0; j &lt; n; ++j)<br>        c[i, j] = (a[i, j] + b[i, j]) % m;<br>    return c;<br>  }<br><br>  long[,] mul(long[,] a, long[,] b, int m, int n)<br>  {<br>    long[,] c = new long[n, n];<br>    for (int i = 0; i &lt; n; ++i)<br>      for (int j = 0; j &lt; n; ++j)<br>        for (int k = 0; k &lt; n; ++k)<br>          c[i, j] = (c[i, j] + a[i, k] * b[k, j]) % m;<br>    return c;<br>  }<br><br>  long[,] zero(int n)<br>  {<br>    return new long[n, n];<br>  }<br><br><br><br>}<br><br><br>// Powered by FileEdit<br>// Powered by TZTester 1.01 [25-Feb-2003] [modified for C# by Petr]<br>// Powered by CodeProcessor<br></td>