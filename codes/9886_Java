<td class="problemText" colspan="8" valign="middle" align="left">
            public class StampsCollection{<br><br>  boolean[] g;<br>  int[] u;<br>  int m;<br>  <br>  public int count(int[] u, int l, int r, int[] b){<br>    int[] res = new int[r+2];<br>    res[r] = 0;res[r+1] = 0;<br>    for(int i = r-1;i&gt;=l;i--){<br>      res[i] = Math.max(res[i+1],b[u[i]]+res[i+2]);<br>    }<br>    return res[l];<br>  }<br>  <br>  boolean[][] e;<br>  <br>  public int find(int v, int p, int d){<br>    p+=d; u[p] = v; g[v] = true;<br>    for(int i = 0;i&lt;m;i++) if (e[v][i] &amp;&amp; !g[i]) return find(i,p,d);<br>    return p;<br>    <br>  }<br>  public int sell(int n, String[] demand, int[] a){<br>    m = demand.length;<br>    int[][] b = new int[m][2];<br>    for(int i = 0;i&lt;m;i++){<br>      String[] s = demand[i].split(" ");<br>      for(int j = 0;j&lt;s.length;j++)<br>        b[i][j] = Integer.parseInt(s[j]);<br>      if (s.length==1) b[i][1] = n+i;<br>    }<br>    e = new boolean[m][m];<br>    for(int i=0;i&lt;m;i++)<br>      for(int j = 0;j&lt;m;j++)<br>        for(int k = 0;k&lt;2;k++)<br>          for(int l = 0;l&lt;2;l++)<br>            if (b[i][k]==b[j][l]) e[i][j] = true;<br>    g = new boolean[m];<br>    u = new int[2*m];<br>    int res = 0;<br>    for(int i = 0;i&lt;m;i++) if (!g[i]){<br>      u[m] = i; g[i] = true;<br>      int l = m;<br>      int r = m+1;<br>      for(int j = 0;j&lt;m;j++) if (e[i][j] &amp;&amp; !g[j]) {l = find(j,m,-1); break;}<br>      for(int j = 0;j&lt;m;j++) if (e[i][j] &amp;&amp; !g[j]) {r = find(j,m, 1)+1; break;}<br>      int[] sol = new int[2*m];<br>      if (!e[u[l]][u[r-1]] || (l+1==r)) res+=count(u,l,r,a);<br>      else res+=Math.max(count(u,l+1,r,a),count(u,l,r-1,a));<br>    }<br>    return res;<br>  }<br>}<br></td>